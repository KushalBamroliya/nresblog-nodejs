<div id="admin-content">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <h1 class="admin-heading">
          <i class="fa fa-comments"></i> Comments Management
        </h1>
      </div>
      <div class="col-md-12">
        <table class="content-table" style="background: white">
          <thead>
            <th>Article</th>
            <th>Name</th>
            <th>Comment</th>
            <th>Status</th>
            <th>Date</th>
            <th>Actions</th>
          </thead>
          <tbody>
            <% comments.forEach(comment => { %>
            <tr>
              <td class="id"><%= comment.article.newsTitle %></td>
              <td><%= comment.name %></td>
              <td><%= comment.content %></td>
              <td><%= comment.status %></td>
              <td>
                <%= new Date(comment.createdAt).toLocaleDateString("en-IN") %>
              </td>
              <td class="edit">
                <div class="d-flex gap-2">
                  <button
                    class="btn btn-primary btn-sm"
                    onclick="viewComment('<%= comment._id %>')"
                  >
                    View
                  </button>
                </div>
              </td>
            </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
<div id="commentModalContainer"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
  function viewComment(id) {
    fetch(`/admin/get-comment/${id}`)
      .then((res) => res.json())
      .then((data) => {
        const html = `
                      <div class="modal fade" id="commentModal" tabindex="-1">
                        <div class="modal-dialog">
                          <div class="modal-content">
                            <div class="modal-header">
                              <h5 class="modal-title">Comment Details</h5>
                              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>

                            <div class="modal-body">
                              <p><strong>Comment:</strong> ${data.content}</p>
                                <br>
                          
                              <div class="mb-3">
                                <label class="form-label"><b>You can change Status</b></label>
                                <select
                                    class="form-control"
                                    id="status"
                                    onchange="updateCommentStatus(event, '${data._id}')"
                                  >
                                    <option value="pending" ${data.status === "pending" ? "selected" : ""}>
                                      Pending
                                    </option>
                                    <option value="approved" ${data.status === "approved" ? "selected" : ""}>
                                      Approved
                                    </option>
                                    <option value="rejected" ${data.status === "rejected" ? "selected" : ""}>
                                      Rejected
                                    </option>
                                  </select>
                              </div>

                              <p><strong>Date:</strong>
                                ${new Date(data.createdAt).toLocaleDateString("en-IN")}
                              </p>
                            </div>

                            <div class="modal-footer">
                              <button class="btn btn-secondary" data-bs-dismiss="modal">
                                Close
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>
                    `;

        const container = document.getElementById("commentModalContainer");
        container.innerHTML = html;

        const modal = new bootstrap.Modal(
          document.getElementById("commentModal")
        );
        modal.show();
        document.getElementById("commentModal").addEventListener("hidden.bs.modal", function () {
        window.location.reload();
      });
      })
      .catch((err) => console.error(err));
  }

  function updateCommentStatus(event, id) {
    const status = event.target.value;

    fetch(`/admin/update-comment-status/${id}`, {
      method: "PUT",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ status }),
    })
      .then((res) => res.json())
      .then((data) => {
        if (data.success) {
          console.log("Status updated");
        } else {
          alert(data.message);
        }
      })
      .catch((err) => console.error(err));
  }




</script>
